name: Build Windows Installer

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        pip install -r requirements.txt

    - name: Build EXE with PyInstaller
      # Ø¯Ù„ØªÙ‡ --collect-all customtkinter Ú‰ÛŒØ± Ù…Ù‡Ù… Ø¯ÛŒ ØªØ±Ú…Ùˆ Ú‰ÛŒØ²Ø§ÛŒÙ† Ø®Ø±Ø§Ø¨ Ù†Ø´ÙŠ
      run: pyinstaller --noconsole --onefile --collect-all customtkinter --name "XsraperPs" XsraperPs.py

    - name: Install Inno Setup Compiler
      run: choco install innosetup

    - name: Compile Setup Wizard
      run: iscc setup.iss

    - name: Upload Setup File to GitHub
      uses: actions/upload-artifact@v4
      with:
        name: ElyasScraper_Setup
        path: Output/ElyasScraper_Setup.exe

    # ---------------------------------------------------
    # Ø¯Ø§ Ù„Ø§Ù†Ø¯Û Ø¨Ø±Ø®Ù‡ Ø³ØªØ§Ø³Ùˆ Ø¯ Ù¼ÛŒÙ„ÛŒÚ«Ø±Ø§Ù… Ù„Ù¾Ø§Ø±Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆÙ‡
    # ---------------------------------------------------
    - name: Send Setup to Telegram
      if: success() # ÛŒÙˆØ§Ø²Û Ú©Ù‡ ØªÛØ± Ú«Ø§Ù…ÙˆÙ†Ù‡ Ú©Ø§Ù…ÛŒØ§Ø¨ Ø´ÙˆÙ„ØŒ Ø¯Ø§ Ø¨Ù‡ Ø±Ù† Ú©ÛŒÚ–ÙŠ
      shell: bash   # Ø¯Ø§ Ù…Ù‡Ù… Ø¯ÛŒ ØªØ±Ú…Ùˆ Ù¾Ù‡ ÙˆÛŒÙ†Ú‰ÙˆØ² Ú©Û curl Ø³Ù… Ú©Ø§Ø± ÙˆÚ©Ú“ÙŠ
      run: |
        curl -v -F "chat_id=${{ secrets.TELEGRAM_TO }}" \
        -F document=@Output/ElyasScraper_Setup.exe \
        -F caption="Ø³Ù„Ø§Ù… Ø§Ù„ÛŒØ§Ø³ Ø¬Ø§Ù†Ù‡! ğŸš€ Ø³ØªØ§Ø³Ùˆ Ø¯ Ø³Ú©Ø±ÛŒÙ¾Ø± Ù†ÙˆÛŒ Ø³ÛŒÙ¼ Ø§Ù¾ (Setup) Ø¬ÙˆÚ“ Ø´Ùˆ." \
        https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendDocument

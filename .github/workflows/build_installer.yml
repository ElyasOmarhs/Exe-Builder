name: Build Windows Installer

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    # Û±. Ù„ÙˆÙ…Ú“ÛŒ Ú«Ø§Ù…: Ø¯ Ú©ÙˆÚ‰ Ø±Ø§ÚšÚ©ØªÙ‡ Ú©ÙˆÙ„
    - uses: actions/checkout@v3

    # [Ù†ÙˆÛŒ] Ø®Ø¨Ø±ØªÛŒØ§: Ù¾Ø±ÙˆØ³Ù‡ Ù¾ÛŒÙ„ Ø´ÙˆÙ‡
    - name: Notify Start
      shell: bash
      run: |
        curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
        -d chat_id=${{ secrets.TELEGRAM_TO }} \
        --data-urlencode "text=ğŸš€ Ø¹Ø§Ù„ÛŒØ¬Ù†Ø§Ø¨Ù‡! Ø¯ Ø¨ÛŒÙˆÙ„Ú‰ (Build) Ù¾Ø±ÙˆØ³Ù‡ Ù¾ÛŒÙ„ Ø´ÙˆÙ‡. Ù„Ú– Ø§Ù†ØªØ¸Ø§Ø± ÙˆÚ©Ú“Ø¦..."

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        pip install -r requirements.txt

    - name: Build EXE with PyInstaller
      run: pyinstaller --noconsole --onefile --collect-all customtkinter --name "XsraperPs" XsraperPs.py

    # [Ù†ÙˆÛŒ] Ø®Ø¨Ø±ØªÛŒØ§: EXE Ø¬ÙˆÚ“ Ø´Ùˆ
    - name: Notify EXE Built
      if: success()
      shell: bash
      run: |
        curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
        -d chat_id=${{ secrets.TELEGRAM_TO }} \
        --data-urlencode "text=âœ… Ù„ÙˆÙ…Ú“ÛŒ Ù¾Ú“Ø§Ùˆ: EXE ÙØ§ÛŒÙ„ Ù¾Ù‡ Ø¨Ø±ÛŒØ§Ù„ÛŒØªÙˆØ¨ Ø¬ÙˆÚ“ Ø´Ùˆ. Ø§ÙˆØ³ Ø³ÛŒÙ¼ Ø§Ù¾ (Setup) Ø¬ÙˆÚ“ÛŒÚ–ÙŠ..."

    - name: Install Inno Setup Compiler
      run: choco install innosetup

    - name: Compile Setup Wizard
      run: iscc setup.iss

    # [Ù†ÙˆÛŒ] Ø®Ø¨Ø±ØªÛŒØ§: Ø³ÛŒÙ¼ Ø§Ù¾ Ø¬ÙˆÚ“ Ø´Ùˆ
    - name: Notify Setup Complete
      if: success()
      shell: bash
      run: |
        curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
        -d chat_id=${{ secrets.TELEGRAM_TO }} \
        --data-urlencode "text=ğŸ“¦ Ø¯ÙˆÙ‡Ù… Ù¾Ú“Ø§Ùˆ: Ø³ÛŒÙ¼ Ø§Ù¾ Ø¬ÙˆÚ“ Ø´Ùˆ! Ø§ÙˆØ³ Ú«ÛŒÙ¼ Ù‡Ø¨ ØªÙ‡ Ù¾ÙˆØ±ØªÙ‡ Ú©ÛŒÚ–ÙŠ..."

    - name: Upload Setup File to GitHub
      uses: actions/upload-artifact@v4
      with:
        name: ElyasScraper_Setup
        path: Output/ElyasScraper_Setup.exe

    # ---------------------------------------------------
    # ÙˆØ±ÙˆØ³ØªÛŒ Ú«Ø§Ù…: ÙØ§ÛŒÙ„ Ù„ÛŒÚ–Ù„
    # ---------------------------------------------------
    - name: Send Setup to Telegram
      if: success()
      shell: bash
      run: |
        curl -v -F "chat_id=${{ secrets.TELEGRAM_TO }}" \
        -F document=@Output/ElyasScraper_Setup.exe \
        -F "caption=ğŸ‰ Ù…Ø¨Ø§Ø±Ú© Ø´Ù‡ Ø§Ø³ØªØ§Ø°Ù‡! Ø¯Ø§ Ø³ØªØ§Ø³Ùˆ ÙˆØ±ÙˆØ³ØªÛŒ ÙØ§ÛŒÙ„ Ø¯ÛŒ." \
        https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendDocument
